<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIT Executive Pipeline Report</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='print.css') }}">
</head>
<body>
    <div class="report-container">
        <!-- Header -->
        <div class="header">
            <h1>MIT Executive Pipeline Report</h1>
            <p class="timestamp">Generated: {{ timestamp }}</p>
        </div>

        <!-- Executive Summary with KPI Boxes -->
        <div class="section">
            <h2>Executive Summary</h2>
            <div class="kpi-grid">
                <div class="kpi-box">
                    <div class="kpi-label">Active MITs</div>
                    <div class="kpi-value">
                        <a href="{{ dashboard_urls.active_mits }}" class="kpi-link" target="_blank">{{ active_mits }}</a>
                    </div>
                </div>
                <div class="kpi-box">
                    <div class="kpi-label">Placement Ready</div>
                    <div class="kpi-value">
                        <a href="{{ dashboard_urls.placement_ready }}" class="kpi-link" target="_blank">{{ ready_mits }}</a>
                    </div>
                </div>
                <div class="kpi-box">
                    <div class="kpi-label">Critical Window (Week 7)</div>
                    <div class="kpi-value at-risk">
                        <a href="{{ dashboard_urls.at_risk }}" class="kpi-link at-risk" target="_blank">{{ mits_by_week_band.week_7|length }}</a>
                    </div>
                </div>
                <div class="kpi-box">
                    <div class="kpi-label">Open Roles</div>
                    <div class="kpi-value">
                        <a href="{{ dashboard_urls.open_roles }}" class="kpi-link" target="_blank">{{ open_positions_count }}</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- MIT Distribution by Week Band -->
        <div class="section">
            <h2>MIT Distribution by Week Band</h2>
            <table>
                <thead>
                    <tr>
                        <th>Week Band</th>
                        <th>Count</th>
                        <th>Description</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Weeks 0-3</td>
                        <td>{{ mits_by_week_band.weeks_0_3|length }}</td>
                        <td>Onboarding</td>
                    </tr>
                    <tr>
                        <td>Weeks 4-6</td>
                        <td>{{ mits_by_week_band.weeks_4_6|length }}</td>
                        <td>Mid-Training</td>
                    </tr>
                    <tr>
                        <td>Week 7</td>
                        <td>{{ mits_by_week_band.week_7|length }}</td>
                        <td>Critical</td>
                    </tr>
                    <tr>
                        <td>Weeks 8+</td>
                        <td>{{ mits_by_week_band.weeks_8_plus|length }}</td>
                        <td>Ready</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- MIT Pipeline by Week Band -->
        <div class="section">
            <h2>MIT Pipeline by Week Band</h2>
            
            <!-- Weeks 0-3 -->
            {% if mits_by_week_band.weeks_0_3 %}
            <h3>Weeks 0-3: Onboarding Phase</h3>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Location</th>
                        <th>Vertical</th>
                        <th>Week</th>
                        <th>Mentor</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mit in mits_by_week_band.weeks_0_3 %}
                    <tr>
                        <td>{{ mit.name }}</td>
                        <td>{{ mit.location }}</td>
                        <td>{{ mit.vertical }}</td>
                        <td>{{ mit.week }}</td>
                        <td>{{ mit.mentor }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}

            <!-- Weeks 4-6 -->
            {% if mits_by_week_band.weeks_4_6 %}
            <h3>Weeks 4-6: Mid-Training</h3>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Location</th>
                        <th>Vertical</th>
                        <th>Week</th>
                        <th>Mentor</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mit in mits_by_week_band.weeks_4_6 %}
                    <tr>
                        <td>{{ mit.name }}</td>
                        <td>{{ mit.location }}</td>
                        <td>{{ mit.vertical }}</td>
                        <td>{{ mit.week }}</td>
                        <td>{{ mit.mentor }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}

            <!-- Week 7 -->
            {% if mits_by_week_band.week_7 %}
            <h3>Week 7: Critical Window</h3>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Location</th>
                        <th>Vertical</th>
                        <th>Week</th>
                        <th>Mentor</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mit in mits_by_week_band.week_7 %}
                    <tr>
                        <td>{{ mit.name }}</td>
                        <td>{{ mit.location }}</td>
                        <td>{{ mit.vertical }}</td>
                        <td>{{ mit.week }}</td>
                        <td>{{ mit.mentor }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}

            <!-- Weeks 8+ -->
            {% if mits_by_week_band.weeks_8_plus %}
            <h3>Weeks 8+: Placement Ready</h3>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Location</th>
                        <th>Vertical</th>
                        <th>Week</th>
                        <th>Mentor</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mit in mits_by_week_band.weeks_8_plus %}
                    <tr>
                        <td>{{ mit.name }}</td>
                        <td>{{ mit.location }}</td>
                        <td>{{ mit.vertical }}</td>
                        <td>{{ mit.week }}</td>
                        <td>{{ mit.mentor }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% endif %}
        </div>

        <!-- Critical Window Mentors -->
        <div class="section">
            <h2>Mentors With MITs in Critical Window (Week 6-7)</h2>
            {% if critical_window_mentors %}
            <table>
                <thead>
                    <tr>
                        <th>Mentor Name</th>
                        <th>Critical MITs Count</th>
                        <th>MITs in Critical Window</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mentor in critical_window_mentors %}
                    <tr>
                        <td>{{ mentor.name }}</td>
                        <td>{{ mentor.critical_count }}</td>
                        <td>
                            {% for mit in mentor.critical_mits %}
                                {{ mit.name }} (Week {{ mit.week }}){% if not loop.last %}, {% endif %}
                            {% endfor %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% else %}
            <p class="no-data">No mentors with MITs in critical window (Week 6-7).</p>
            {% endif %}
        </div>

        <!-- Training Indicators -->
        <div class="section">
            <h2>Training Indicators</h2>
            <p style="font-size: 9pt; color: #666; margin-bottom: 10px; font-style: italic;">
                Metrics calculated for MITs who completed assessments ({{ training_indicators.candidates_count }} candidates).
            </p>
            <table>
                <thead>
                    <tr>
                        <th>Indicator</th>
                        <th>Value</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Onboarding Completion %</td>
                        <td>{{ "%.1f"|format(training_indicators.onboarding_completion) }}%</td>
                    </tr>
                    <tr>
                        <td>Lessons Completion %</td>
                        <td>{{ "%.1f"|format(training_indicators.lessons_completion) }}%</td>
                    </tr>
                    <tr>
                        <td>Avg Mock QBR Score</td>
                        <td>{{ training_indicators.avg_qbr_score if training_indicators.avg_qbr_score else "N/A" }}</td>
                    </tr>
                    <tr>
                        <td>Avg Performance Score</td>
                        <td>{{ training_indicators.avg_perf_score if training_indicators.avg_perf_score else "N/A" }}</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Mentor Assessment Executive Summary -->
        <div class="section mentor-summary-section">
            <h2>Mentor Assessment Executive Summary</h2>
            <p class="executive-summary">{{ assessment_summary }}</p>
        </div>

        <!-- Mentor Assessment Top/Bottom MITs -->
        <div class="section mentor-assessment">
            <h2>Top 2 MITs — Mentor Assessment Performance</h2>
            {% if top_2_mits %}
                {% for mit in top_2_mits %}
                <div class="mit-block good">
                    <h3>{{ mit.name }} — {{ "%.2f"|format(mit.overall) }} avg</h3>
                    <ul>
                        <li>Core Competencies: {{ "%.2f"|format(mit.section_1) }}</li>
                        <li>Soft Skills: {{ "%.2f"|format(mit.section_2) }}</li>
                        <li>Engagement: {{ "%.2f"|format(mit.section_3) }}</li>
                        <li>Readiness: {{ "%.2f"|format(mit.section_4) }}</li>
                    </ul>
                    <p class="feedback">{{ mit.observations }}</p>
                </div>
                {% endfor %}
            {% else %}
                <p class="no-data">No top performers available.</p>
            {% endif %}

            <h2>MITs Requiring Development Focus</h2>
            {% if bottom_2_mits %}
                {% for mit in bottom_2_mits %}
                <div class="mit-block bad">
                    <h3>{{ mit.name }} — {{ "%.2f"|format(mit.overall) }} avg</h3>
                    <ul>
                        <li>Core Competencies: {{ "%.2f"|format(mit.section_1) }}</li>
                        <li>Soft Skills: {{ "%.2f"|format(mit.section_2) }}</li>
                        <li>Engagement: {{ "%.2f"|format(mit.section_3) }}</li>
                        <li>Readiness: {{ "%.2f"|format(mit.section_4) }}</li>
                    </ul>
                    <p class="feedback">{{ mit.observations }}</p>
                </div>
                {% endfor %}
            {% else %}
                <p class="no-data">All MITs scored above 3.5, indicating strong overall performance. No development focus candidates at this time.</p>
            {% endif %}
        </div>

        <!-- Performance Insights -->
        <div class="section">
            <h2>Performance Insights</h2>
            <ul class="highlights-list">
                {% for insight in performance_insights %}
                <li>{{ insight|safe }}</li>
                {% endfor %}
            </ul>
        </div>

        <!-- Weekly Meeting Insights -->
        <div class="section">
            <h2>Prior Meeting Insights</h2>
            {% if meeting_insights %}
            <ul class="highlights-list">
                {% for insight in meeting_insights %}
                <li>{{ insight }}</li>
                {% endfor %}
            </ul>
            {% else %}
            <p class="no-data">No meeting insights available.</p>
            {% endif %}
        </div>

        <!-- Appendix: All MITs -->
        <div class="section">
            <h2>Appendix: Complete MIT Roster</h2>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Vertical</th>
                        <th>Week</th>
                        <th>Location</th>
                        <th>Mentor</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mit in all_mits %}
                    <tr>
                        <td>{{ mit.name }}</td>
                        <td>{{ mit.vertical }}</td>
                        <td>{{ mit.week }}</td>
                        <td>{{ mit.location }}</td>
                        <td>{{ mit.mentor }}</td>
                        <td>{{ mit.status }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>For detailed information, visit: <a href="{{ dashboard_url }}" target="_blank">{{ dashboard_url }}</a></p>
        </div>
    </div>
</body>
</html>

