<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIT Executive Pipeline Report</title>
    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            background: #f8fafc; 
            color: #1e293b; 
            line-height: 1.5;
            padding: 20px;
        }
        .report-container { max-width: 1000px; margin: 0 auto; background: white; }
        
        /* Header */
        .header { 
            background: linear-gradient(135deg, #1e3a5f 0%, #2d5a87 100%); 
            color: white; 
            padding: 30px 40px; 
            text-align: center;
        }
        .header h1 { font-size: 28px; font-weight: 700; margin-bottom: 8px; }
        .header .timestamp { font-size: 14px; opacity: 0.9; }
        
        /* KPI Grid - 5 boxes */
        .kpi-grid { 
            display: grid; 
            grid-template-columns: repeat(5, 1fr); 
            gap: 0; 
            border-bottom: 3px solid #e2e8f0;
        }
        .kpi-box { 
            padding: 20px 15px; 
            text-align: center; 
            border-right: 1px solid #e2e8f0;
            background: white;
        }
        .kpi-box:last-child { border-right: none; }
        .kpi-label { font-size: 11px; color: #64748b; text-transform: uppercase; font-weight: 600; margin-bottom: 8px; }
        .kpi-value { font-size: 36px; font-weight: 700; color: #1e3a5f; }
        .kpi-value.critical { color: #dc2626; }
        .kpi-value.warning { color: #f59e0b; }
        .kpi-value.success { color: #059669; }
        .kpi-sublabel { font-size: 10px; color: #94a3b8; margin-top: 4px; }
        
        /* Sections */
        .section { padding: 25px 40px; border-bottom: 1px solid #e2e8f0; }
        .section:last-child { border-bottom: none; }
        .section h2 { 
            font-size: 16px; 
            color: #1e3a5f; 
            margin-bottom: 15px; 
            padding-bottom: 8px; 
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .section h3 { font-size: 14px; color: #475569; margin: 20px 0 10px 0; }
        
        /* Priority Section - subtle styling */
        .priority-section { background: white; border-left: 4px solid #dc2626; }
        .priority-section h2 { color: #dc2626; border-bottom-color: #e2e8f0; }
        
        .ready-section { background: white; border-left: 4px solid #059669; }
        .ready-section h2 { color: #059669; border-bottom-color: #e2e8f0; }
        
        .new-section { background: white; border-left: 4px solid #3b82f6; }
        .new-section h2 { color: #3b82f6; border-bottom-color: #e2e8f0; }
        
        /* Tables */
        table { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 10px; }
        th { 
            background: #f1f5f9; 
            color: #475569; 
            font-weight: 600; 
            text-transform: uppercase; 
            font-size: 10px; 
            padding: 10px 12px; 
            text-align: left;
            border-bottom: 2px solid #e2e8f0;
        }
        td { padding: 10px 12px; border-bottom: 1px solid #f1f5f9; }
        tr:hover { background: #f8fafc; }
        
        /* Status badges */
        .status-badge { 
            display: inline-block; 
            padding: 3px 8px; 
            border-radius: 12px; 
            font-size: 10px; 
            font-weight: 600; 
        }
        .status-strong { background: #dcfce7; color: #166534; }
        .status-ontrack { background: #dbeafe; color: #1e40af; }
        .status-monitor { background: #fef3c7; color: #92400e; }
        .status-pending { background: #f1f5f9; color: #64748b; }
        
        /* Score display */
        .score { font-weight: 600; }
        .score-high { color: #059669; }
        .score-mid { color: #f59e0b; }
        .score-low { color: #dc2626; }
        
        /* Observation box */
        .observation { 
            background: #f8fafc; 
            padding: 10px 12px; 
            border-radius: 6px; 
            font-size: 11px; 
            color: #64748b; 
            margin-top: 8px;
            font-style: italic;
        }
        
        /* MIT Card for critical/ready sections */
        .mit-card { 
            background: white; 
            border: 1px solid #e2e8f0; 
            border-radius: 8px; 
            padding: 15px; 
            margin-bottom: 12px;
        }
        .mit-card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px; }
        .mit-card-name { font-weight: 600; color: #1e293b; font-size: 14px; }
        .mit-card-meta { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; font-size: 11px; }
        .mit-card-meta-item label { color: #94a3b8; display: block; font-size: 9px; text-transform: uppercase; }
        .mit-card-meta-item span { color: #334155; font-weight: 500; }
        
        /* Insights */
        .insights-list { list-style: none; }
        .insights-list li { 
            padding: 10px 15px; 
            margin-bottom: 8px; 
            background: #f8fafc; 
            border-radius: 6px;
            font-size: 13px;
            border-left: 3px solid #cbd5e1;
        }
        .insights-list li:nth-child(1) { border-left-color: #dc2626; }
        .insights-list li:nth-child(2) { border-left-color: #f59e0b; }
        .insights-list li:nth-child(3) { border-left-color: #3b82f6; }
        
        /* Mock QBR Schedule */
        .qbr-schedule { display: flex; gap: 15px; flex-wrap: wrap; }
        .qbr-item { 
            background: #fefce8; 
            border: 1px solid #fde047; 
            padding: 10px 15px; 
            border-radius: 6px; 
            font-size: 12px;
        }
        .qbr-item strong { color: #854d0e; }
        
        /* Meeting insights */
        .meeting-insights { columns: 2; column-gap: 30px; }
        .meeting-insights li { 
            padding: 6px 0; 
            border-bottom: 1px solid #f1f5f9; 
            font-size: 12px;
            break-inside: avoid;
        }
        
        /* Footer */
        .footer { 
            background: #f8fafc; 
            padding: 20px 40px; 
            text-align: center; 
            font-size: 11px; 
            color: #64748b;
        }
        .footer a { color: #3b82f6; }
        
        /* Print styles */
        @media print {
            body { padding: 0; background: white; }
            .report-container { max-width: none; }
            .header { padding: 20px 30px; }
            .header h1 { font-size: 22px; }
            .section { padding: 15px 30px; }
            .kpi-value { font-size: 28px; }
            .mit-card { page-break-inside: avoid; }
            .priority-section, .ready-section, .new-section { 
                -webkit-print-color-adjust: exact !important; 
                print-color-adjust: exact !important; 
            }
        }
    </style>
</head>
<body>
    <div class="report-container">
        <!-- Header -->
        <div class="header">
            <h1>MIT Executive Pipeline Report</h1>
            <p class="timestamp">Generated: {{ timestamp }}</p>
        </div>

        <!-- KPI Grid - 5 Boxes -->
            <div class="kpi-grid">
                <div class="kpi-box">
                    <div class="kpi-label">Active MITs</div>
                <div class="kpi-value">{{ active_mits }}</div>
                <div class="kpi-sublabel">Total Pipeline</div>
                    </div>
            <div class="kpi-box">
                <div class="kpi-label">New Starts</div>
                <div class="kpi-value success">{{ band_counts.new_starts }}</div>
                <div class="kpi-sublabel">Weeks 0-3</div>
                </div>
                <div class="kpi-box">
                <div class="kpi-label">Mid-Training</div>
                <div class="kpi-value">{{ band_counts.mid_training }}</div>
                <div class="kpi-sublabel">Weeks 4-5</div>
                </div>
                <div class="kpi-box">
                <div class="kpi-label">Critical Window</div>
                <div class="kpi-value critical">{{ band_counts.critical_window }}</div>
                <div class="kpi-sublabel">Weeks 6-7</div>
                </div>
                <div class="kpi-box">
                <div class="kpi-label">Placement Ready</div>
                <div class="kpi-value warning">{{ band_counts.placement_ready }}</div>
                <div class="kpi-sublabel">Week 8+</div>
            </div>
        </div>

        <!-- CRITICAL WINDOW SECTION -->
        {% if mits_by_week_band.weeks_6_7 %}
        <div class="section priority-section">
            <h2>üö® Critical Window ‚Äî Immediate Placement Attention (Weeks 6-7)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Week</th>
                        <th>Location</th>
                        <th>Mentor Score</th>
                        <th>Mock QBR</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mit in mits_by_week_band.weeks_6_7 %}
                    <tr>
                        <td><strong>{{ mit.name }}</strong></td>
                        <td>{{ mit.week }}</td>
                        <td>{{ mit.location }}</td>
                        <td class="score {% if mit.mentor_score and mit.mentor_score >= 4.0 %}score-high{% elif mit.mentor_score and mit.mentor_score >= 3.0 %}score-mid{% elif mit.mentor_score %}score-low{% endif %}">
                            {% if mit.mentor_score %}{{ "%.1f"|format(mit.mentor_score) }}/5{% else %}Pending{% endif %}
                        </td>
                        <td>{% if mit.mock_qbr_date and mit.mock_qbr_date != 'nan' %}{{ mit.mock_qbr_date }}{% else %}TBD{% endif %}</td>
                        <td>
                            <span class="status-badge {% if mit.readiness_status == 'Strong' %}status-strong{% elif mit.readiness_status == 'On Track' %}status-ontrack{% elif mit.readiness_status == 'Monitor' %}status-monitor{% else %}status-pending{% endif %}">
                                {{ mit.readiness_status }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
            {% endif %}

        <!-- PLACEMENT READY SECTION -->
        {% if mits_by_week_band.weeks_8_plus %}
        <div class="section ready-section">
            <h2>‚úÖ Placement Ready ‚Äî Awaiting Assignment (Week 8+)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Week</th>
                        <th>Vertical</th>
                        <th>Mentor Score</th>
                        <th>Mock QBR</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mit in mits_by_week_band.weeks_8_plus %}
                    <tr>
                        <td><strong>{{ mit.name }}</strong></td>
                        <td>{% if mit.week >= 12 %}<span style="color: #dc2626; font-weight: 600;">{{ mit.week }} ‚ö†Ô∏è</span>{% else %}{{ mit.week }}{% endif %}</td>
                        <td>{{ mit.vertical }}</td>
                        <td class="score {% if mit.mentor_score and mit.mentor_score >= 4.0 %}score-high{% elif mit.mentor_score and mit.mentor_score >= 3.0 %}score-mid{% elif mit.mentor_score %}score-low{% endif %}">
                            {% if mit.mentor_score %}{{ "%.1f"|format(mit.mentor_score) }}/5{% else %}‚Äî{% endif %}
                        </td>
                        <td>{% if mit.mock_qbr_score %}{{ mit.mock_qbr_score }}/4 ‚úì{% elif mit.mock_qbr_date and mit.mock_qbr_date != 'nan' %}{{ mit.mock_qbr_date }}{% else %}Pending{% endif %}</td>
                        <td>
                            <span class="status-badge {% if mit.readiness_status == 'Strong' %}status-strong{% elif mit.readiness_status == 'On Track' %}status-ontrack{% elif mit.readiness_status == 'Monitor' %}status-monitor{% else %}status-pending{% endif %}">
                                {{ mit.readiness_status }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
            {% endif %}

        <!-- NEW STARTS SECTION -->
        {% if mits_by_week_band.weeks_0_3 %}
        <div class="section new-section">
            <h2>üå± New Starts ‚Äî Onboarding Progress (Weeks 0-3)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Week</th>
                        <th>Location</th>
                        <th>Mentor</th>
                        <th>First Survey</th>
                        <th>OIG Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mit in mits_by_week_band.weeks_0_3 %}
                    <tr>
                        <td><strong>{{ mit.name }}</strong></td>
                        <td>{{ mit.week }}</td>
                        <td>{{ mit.location }}</td>
                        <td>{{ mit.mentor }}</td>
                        <td>
                            {% if mit.first_survey_submitted %}
                                <span style="color: #059669;">‚úì {{ "%.1f"|format(mit.mentor_score) }}/5</span>
                            {% else %}
                                <span style="color: #94a3b8;">Pending</span>
                            {% endif %}
                        </td>
                        <td>{{ mit.oig_status }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
            {% endif %}

        <!-- MID-TRAINING SECTION -->
        {% if mits_by_week_band.weeks_4_5 %}
        <div class="section">
            <h2>üìö Mid-Training (Weeks 4-5)</h2>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Week</th>
                        <th>Location</th>
                        <th>Vertical</th>
                        <th>Mentor Score</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mit in mits_by_week_band.weeks_4_5 %}
                    <tr>
                        <td>{{ mit.name }}</td>
                        <td>{{ mit.week }}</td>
                        <td>{{ mit.location }}</td>
                        <td>{{ mit.vertical }}</td>
                        <td class="score {% if mit.mentor_score and mit.mentor_score >= 4.0 %}score-high{% elif mit.mentor_score and mit.mentor_score >= 3.0 %}score-mid{% elif mit.mentor_score %}score-low{% endif %}">
                            {% if mit.mentor_score %}{{ "%.1f"|format(mit.mentor_score) }}/5{% else %}‚Äî{% endif %}
                        </td>
                        <td>
                            <span class="status-badge {% if mit.readiness_status == 'Strong' %}status-strong{% elif mit.readiness_status == 'On Track' %}status-ontrack{% elif mit.readiness_status == 'Monitor' %}status-monitor{% else %}status-pending{% endif %}">
                                {{ mit.readiness_status }}
                            </span>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% endif %}

        <!-- UPCOMING MOCK QBRs -->
        {% if upcoming_mock_qbrs %}
        <div class="section">
            <h2>üìÖ Upcoming Mock QBRs</h2>
            <div class="qbr-schedule">
                {% for qbr in upcoming_mock_qbrs %}
                <div class="qbr-item">
                    <strong>{{ qbr.date }}</strong> ‚Äî {{ qbr.name }} (Week {{ qbr.week }})
                </div>
                {% endfor %}
                </div>
        </div>
        {% endif %}

        <!-- KEY INSIGHTS -->
        <div class="section">
            <h2>üí° Key Insights</h2>
            <ul class="insights-list">
                {% for insight in performance_insights %}
                <li>{{ insight|safe }}</li>
                {% endfor %}
            </ul>
        </div>

        <!-- TOP PERFORMERS -->
        {% if top_2_mits %}
        <div class="section">
            <h2>‚≠ê Top Performers ‚Äî Mentor Assessment</h2>
            {% for mit in top_2_mits %}
            <div style="margin-bottom: 20px; padding: 15px; background: #f8fafc; border-radius: 8px; border-left: 4px solid #059669;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <strong style="font-size: 14px; color: #1e293b;">{{ mit.name }}</strong>
                    <span style="background: #dcfce7; color: #166534; padding: 4px 12px; border-radius: 12px; font-size: 12px; font-weight: 600;">{{ "%.2f"|format(mit.overall) }}/5</span>
                </div>
                <div style="display: flex; gap: 20px; font-size: 11px; color: #64748b; margin-bottom: 10px;">
                    <span>Core: {{ "%.1f"|format(mit.section_1) }}</span>
                    <span>Soft Skills: {{ "%.1f"|format(mit.section_2) }}</span>
                    <span>Engagement: {{ "%.1f"|format(mit.section_3) }}</span>
                    <span>Readiness: {{ "%.1f"|format(mit.section_4) }}</span>
                </div>
                {% if mit.observations %}
                <div style="font-size: 12px; color: #475569; font-style: italic; border-top: 1px solid #e2e8f0; padding-top: 10px;">
                    "{{ mit.observations }}"
                </div>
                {% endif %}
            </div>
                {% endfor %}
        </div>
        {% endif %}

        <!-- NEEDS DEVELOPMENT - No observations shown to avoid outdated context -->
        {% if bottom_2_mits %}
        <div class="section">
            <h2>üìà Development Focus</h2>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Overall</th>
                        <th>Core</th>
                        <th>Soft Skills</th>
                        <th>Engagement</th>
                        <th>Readiness</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mit in bottom_2_mits %}
                    <tr>
                        <td><strong>{{ mit.name }}</strong></td>
                        <td class="score score-mid">{{ "%.2f"|format(mit.overall) }}</td>
                        <td>{{ "%.1f"|format(mit.section_1) }}</td>
                        <td>{{ "%.1f"|format(mit.section_2) }}</td>
                        <td>{{ "%.1f"|format(mit.section_3) }}</td>
                        <td>{{ "%.1f"|format(mit.section_4) }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            {% for mit in bottom_2_mits %}
                {% if mit.observations and mit.observations.strip() %}
                <div style="margin-top: 15px; padding: 12px; background: #f8fafc; border-left: 3px solid #f59e0b; border-radius: 6px;">
                    <div style="font-size: 11px; color: #64748b; text-transform: uppercase; font-weight: 600; margin-bottom: 6px;">{{ mit.name }} ‚Äî Latest Mentor Feedback</div>
                    <div style="font-size: 12px; color: #475569; line-height: 1.5; font-style: italic;">"{{ mit.observations }}"</div>
                </div>
                {% endif %}
            {% endfor %}
        </div>
        {% endif %}

        <!-- MEETING INSIGHTS -->
        {% if meeting_insights %}
        <div class="section">
            <h2>üìã Prior Meeting Notes</h2>
            <ul class="meeting-insights">
                {% for insight in meeting_insights %}
                <li>{{ insight }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <!-- JOB OPENINGS BY REGION -->
        {% if positions_by_region %}
        <div class="section">
            <h2>üíº Job Openings by Region</h2>
            {% for region, positions in positions_by_region.items() %}
            <div style="margin-bottom: 30px;">
                <h3 style="font-size: 14pt; color: #1e293b; margin-bottom: 12px; padding-bottom: 8px; border-bottom: 2px solid #e2e8f0;">
                    {{ region }} ({{ positions|length }} position{{ 's' if positions|length != 1 else '' }})
                </h3>
                <table style="width: 100%; margin-bottom: 20px;">
                    <thead>
                        <tr style="background: #f8fafc;">
                            <th style="text-align: left; padding: 10px; border-bottom: 2px solid #e2e8f0;">Job Title</th>
                            <th style="text-align: left; padding: 10px; border-bottom: 2px solid #e2e8f0;">Account</th>
                            <th style="text-align: left; padding: 10px; border-bottom: 2px solid #e2e8f0;">Location</th>
                            <th style="text-align: left; padding: 10px; border-bottom: 2px solid #e2e8f0;">Vertical</th>
                            <th style="text-align: left; padding: 10px; border-bottom: 2px solid #e2e8f0;">Salary</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for position in positions %}
                        <tr style="border-bottom: 1px solid #f1f5f9;">
                            <td style="padding: 10px; color: #334155; font-weight: 500;">{{ position.title }}</td>
                            <td style="padding: 10px; color: #64748b;">{{ position.account }}</td>
                            <td style="padding: 10px; color: #64748b;">{{ position.city }}{% if position.state %}, {{ position.state }}{% endif %}</td>
                            <td style="padding: 10px; color: #64748b;">{{ position.vertical }}</td>
                            <td style="padding: 10px; color: #64748b;">
                                {% if position.salary %}
                                    {% if position.salary is string %}
                                        {{ position.salary }}
                                    {% else %}
                                        ${{ "{:,.0f}".format(position.salary) }}
                                    {% endif %}
                                {% else %}
                                    TBD
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        <!-- APPENDIX: Complete MIT Roster -->
        <div class="section">
            <h2>üìë Appendix: Complete MIT Roster</h2>
            <table>
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Vertical</th>
                        <th>Week</th>
                        <th>Location</th>
                        <th>Mentor</th>
                        <th>Status</th>
                        <th>Scores</th>
                    </tr>
                </thead>
                <tbody>
                    {% for mit in all_mits %}
                    <tr>
                        <td>{{ mit.name }}</td>
                        <td>{{ mit.vertical }}</td>
                        <td>{{ mit.week }}</td>
                        <td>{{ mit.location }}</td>
                        <td>{{ mit.mentor }}</td>
                        <td>{{ mit.status }}</td>
                        <td>{{ mit.scores }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Full dashboard: <a href="{{ dashboard_url }}" target="_blank">{{ dashboard_url }}</a></p>
        </div>
    </div>
</body>
</html>
